<html>
    <head>
        <link rel="stylesheet" href="./css/style.css">
    </head>

    <body style="background-color: rgba(49, 48, 48, 0.24);">
        
        <object type="image/svg+xml" data="./img/card.svg" id="card-0"></object>
        <object type="image/svg+xml" data="./img/card.svg" id="card-1"></object>
        <object type="image/svg+xml" data="./img/card.svg" id="card-2"></object>

        <script>
            var couleurs
            fetch('./data/couleurs.json')
            .then((response) => response.json())
            .then((json) => couleurs = json);

            const socket = new WebSocket("ws://localhost:7071")

            function changeName(newName, carteCouleur, numeroScanner) {

                const card = document.querySelector(`#card-${numeroScanner}`)
                numbers = card.contentDocument.querySelectorAll(".number")
                couleur = card.contentDocument.querySelector(".couleur")

                numbers.forEach((number) => {

                    number.innerHTML = newName
                })

                switch (carteCouleur) {

                    case "coeur" :
                        couleur.innerHTML = couleurs.coeur
                        break
                    case "trefle" :
                        couleur.innerHTML = couleurs.trefle
                        break
                    case "pique" :
                        couleur.innerHTML = couleurs.pique
                        break
                    case "carreau" :
                        couleur.innerHTML = couleurs.carreau
                        break
                }
            }

            socket.addEventListener("message", (event) => {

                // regular expression (regex) to match the data from Serial port
                const regex = /(\d)\|(.*)/g;
                const data = regex.exec(event.data)
                const numeroScanner = data[1]
                const msg = data[2]

                if (msg === "F315D704") changeName("10", "coeur", numeroScanner);

                else if (msg === "03FD4C06") changeName("A", "trefle", numeroScanner);

                else if (msg === "635B3F06") changeName("3", "pique", numeroScanner);

                else if (msg === "53047106") changeName("R", "carreau", numeroScanner);

                else if (msg === "53937006") changeName("D", "coeur", numeroScanner);

            })

        </script>
    </body>
</html>